---
// Компонент карточки веб-проекта / сайта

interface Props {
	link?: string;
	cover?: string;
	caption?: string;
}

const { link, cover, caption } = Astro.props;

// Если link есть, используем <a>, иначе обёртка через Fragment не создаст лишнего узла в DOM
const Element = link ? "a" : Fragment;
const attributes = link ? { href: link, class: "card-dev-linkwrapper", target: "_blank" } : {};
---

<Element {...attributes}>
	<figure class="card-dev shine-overlay collection-item">
		{
			cover && (
				<div class="card-dev-cover">
					<img class="card-dev-cover--img" src={cover} alt={caption} loading="lazy" />
				</div>
			)
		}
		{
			caption && (
				<figcaption>
					{caption}
				</figcaption>
			)
		}
		<div class="shine"></div>
	</figure>
</Element>

<style is:global>
	.card-dev-linkwrapper {
		all: unset;
		cursor: pointer;
	}

	.card-dev {
		position: relative;
		& .card-dev-cover {
			width: 100%;
			height: auto;
			aspect-ratio: 16 / 9;
			border-radius: var(--radius-button-xxl);
			@supports (corner-shape: squircle) {
				corner-shape: squircle;
			}
			outline: 4px solid var(--color-bg-xh);
			/* outline-offset: var(--space-xxs); */
			overflow: clip;
			transition: scale 0.25s ease-in-out;
			filter: drop-shadow(2px 14px 13px hsl(var(--shadow-color) / 0.53));
			& > .card-dev-cover--img {
				width: 100%;
				height: 100%;
				object-fit: cover;
				object-position: top center;
			}
		}
		& figcaption {
			margin-block-start: var(--space-s);
			font-family: var(--font-family-secondary);
			font-size: var(--font-size-main);
			font-kerning: auto;
			font-optical-sizing: auto;
			letter-spacing: -0.03em;
			line-height: 1.1;
			text-wrap: balance;
			color: var(--color-content-s);
			font-variation-settings:
				"opsz" 8,
				"wght" var(--font-weight-semibold),
				"GRAD" var(--font-grade-chapter-subtitle);
			position: relative;
			z-index: +1;
		}
	}

	@media (hover: hover) and (pointer: fine) {
		.card-dev-linkwrapper:hover,
		.card-dev-linkwrapper:focus {
			& .card-dev-cover {
				scale: 1.045;
			}
		}
	}

	.card-dev-linkwrapper:focus {
		& .card-dev-cover {
			outline: 3px solid var(--color-link);
		}
	}

	.shine-overlay {
		position: relative;
	}
	.shine-overlay:hover .shine {
		display: block;
		scale: 1.045;
	}
	.shine {
		display: none;
		position: absolute;
		left: 0;
		top: 0;
		width: 100%;
		height: 100%;
		background: #fff;
		background: linear-gradient(to right, rgba(255, 255, 255, 0) 0, rgba(255, 255, 255, 0.8) 50%, rgba(255, 255, 255, 0) 100%);
		pointer-events: none;
		z-index: 3;
		opacity: 0;
		transform: skew(30deg);
		animation: shine 0.3s linear;
	}
	@keyframes shine {
		0% {
			left: -50%;
			opacity: 0;
		}
		50% {
			left: -10%;
			opacity: 0.4;
		}
		100% {
			left: 35%;
			opacity: 0;
		}
	}
</style>
